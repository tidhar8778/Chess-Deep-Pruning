/*-------------------------------------------------------------------------------
  tucano is a chess playing engine developed by Alcides Schulz.
  Copyright (C) 2011-present - Alcides Schulz

  tucano is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  tucano is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You can find the GNU General Public License at http://www.gnu.org/licenses/
-------------------------------------------------------------------------------*/

#include "globals.h"

//-------------------------------------------------------------------------------------------------
//    Zobrist keys functions.
//-------------------------------------------------------------------------------------------------

static const U64        color_key = ((U64)0x6CA3EC67E69AA24C);

static const U64        square_keys[2][7][64] =
{{
       {((U64)0x16E520815D81299F), ((U64)0x27EF3721E729673D), ((U64)0x62366C6B3D83DB1B), ((U64)0x2BCF0C4D85A9F9E5), 
        ((U64)0x68964A06F8A04041), ((U64)0x9BFE7C1D6A8FE213), ((U64)0x61623E6FF53479DF), ((U64)0x82FA3B9E8E751D9D), 
        ((U64)0x0B4B9C4580C73CC0), ((U64)0x9EF3A09D63C28081), ((U64)0x37AA02293ECBBEAE), ((U64)0x8F23FCA1D76FFD37), 
        ((U64)0x5F175F622E9F3A9A), ((U64)0x64272B93BD58F152), ((U64)0xD466A89787761783), ((U64)0x34734D49B345A448), 
        ((U64)0x16D7C964A7113ED0), ((U64)0xC72295E50D71F6A2), ((U64)0xBB67FAD753240231), ((U64)0x5AB213DB27EBB9DD), 
        ((U64)0xA96F8EBC9D94E656), ((U64)0xDCFEE02DA9DDDDC0), ((U64)0xEA4107ECE0AA8EED), ((U64)0x0FB06957CA581DFF), 
        ((U64)0x3045B4970AA431CA), ((U64)0x8A6BD00E61E8B355), ((U64)0x621D44E21705322B), ((U64)0xBC8EA1F5F0DECD7E), 
        ((U64)0xF38E9A01E84E226A), ((U64)0xE4DD0610E7C4D7C4), ((U64)0x8A9C7C333DB9B9AC), ((U64)0x68702CA9D62ACFED), 
        ((U64)0x8CDCDCE206E71C41), ((U64)0x1D61ED17139357D1), ((U64)0xFA37798B625878D5), ((U64)0x0B1572BF66D633E9), 
        ((U64)0x1078AFB92BDC41A2), ((U64)0xEBA3745C4A0EAD86), ((U64)0x18ACAED2AD1E0043), ((U64)0xC9DF5081D3A75D9F), 
        ((U64)0x8601A5388CA3BBD8), ((U64)0xC78A5506F0D6CD53), ((U64)0x67F49F8986B8749D), ((U64)0x11B88FF662682B8E), 
        ((U64)0xF0D666A7D7D0A51D), ((U64)0x480E5447FA572376), ((U64)0x483E0F78112458AA), ((U64)0x18695EA31761358A), 
        ((U64)0xC0C53A199E4407C9), ((U64)0x35AC430DB353E59B), ((U64)0xE37321A895B2DEA4), ((U64)0xC7D0A76A3174AA03), 
        ((U64)0xFB84CD6F8E7FA6CC), ((U64)0xD704AC441C125CC5), ((U64)0xE4C544B62A2A94CD), ((U64)0x5D88297152D60D85), 
        ((U64)0x4774CB315416835F), ((U64)0x462212A537238B6D), ((U64)0xF8C239692F080140), ((U64)0x516D351B90666080), 
        ((U64)0x9825CE2F8D3FD3F7), ((U64)0x94E7AF1AD7CF53EA), ((U64)0x0A6FD0A3E8E2010B), ((U64)0xED94481181ACEF4A)},
       {((U64)0x152A58F9E889607C), ((U64)0x2F2810AF5A1A8312), ((U64)0x69F12DA056E9FE7B), ((U64)0x2A23B15BCB715063), 
        ((U64)0x9BAF26235CA877B8), ((U64)0xC0E34F0ECE76631F), ((U64)0x0133097D088D52B8), ((U64)0x5794D68A7EF654FA), 
        ((U64)0xB35C1658CC6CF213), ((U64)0x2F2D90978305BAD4), ((U64)0x03202519543A6693), ((U64)0xF9E022EDC7D3EFAD), 
        ((U64)0x16FBD14408D3757E), ((U64)0xEA3DB4FBF48ADCE1), ((U64)0x89DDA6437140669C), ((U64)0x6F0F19E2026ED596), 
        ((U64)0xC96D1E4203356EAE), ((U64)0xF723E57250EDAB85), ((U64)0x308FAD33D6D01E78), ((U64)0xB3B5B524F515DD83), 
        ((U64)0x575AC9E7A19D738C), ((U64)0xC7A7DB76D5693473), ((U64)0x5D261F5CA221CF72), ((U64)0x3FD6C840C5BAE186), 
        ((U64)0x3E3CBD56073782EA), ((U64)0x7ECF5F1CB253C8F8), ((U64)0x56B0B48465B29651), ((U64)0x9EAD5205A64AA6AF), 
        ((U64)0xE91FBC60C2E45578), ((U64)0x488D0DEDBE88B65C), ((U64)0x9CBBC33423AAB46A), ((U64)0x2BDED51011AA0F15), 
        ((U64)0x3BB6AF8235EA33F6), ((U64)0xC3166B5CE4738286), ((U64)0x2C34B974555BCFF7), ((U64)0x0896A065534D9A1C), 
        ((U64)0x8C32CE9FA4C806AC), ((U64)0xC0630BC692BA50E4), ((U64)0xA6567ED9C1E57FA7), ((U64)0xA307E119B375F6F3), 
        ((U64)0x2463B1A044269218), ((U64)0x3E523B021A83D38B), ((U64)0xA61DCCE285F63578), ((U64)0xB2D8060A82062D5D), 
        ((U64)0x4AA09BD0F3EA94E8), ((U64)0xCBFA2F81C567EC9B), ((U64)0x18C65AA30EAE5CC2), ((U64)0xA4F16EA85A0120B3), 
        ((U64)0xAAF84718BA67BB28), ((U64)0x8A9E4B050CF3E3E6), ((U64)0x15CE68C2E9A03F95), ((U64)0xA93E0DCD57A37127), 
        ((U64)0x712A23FEB1B09ABD), ((U64)0x00CD79D87DD6D4D2), ((U64)0xBB042ACA2BF40745), ((U64)0x2CC999A89B1A7F4B), 
        ((U64)0xBBE6337EF90B2D13), ((U64)0x9E28B1A6F0ACB87D), ((U64)0xE919BABDD2A96C44), ((U64)0xF2CC11B5D1E015D2), 
        ((U64)0x89D56FAF9C7FFA13), ((U64)0x7651E0DB62663020), ((U64)0xB541540DDDF7E931), ((U64)0x771C93C720B77D96)},
       {((U64)0x68EB0834C48F6859), ((U64)0x61820F91565373B7), ((U64)0xCC52E2D0C9D2852F), ((U64)0x1C8B891D6840FFDC), 
        ((U64)0x587C6787A00066A5), ((U64)0x7947A315CBCE08DF), ((U64)0x6BF78452A58A8979), ((U64)0x41A56491FE3A1AD5), 
        ((U64)0x36A1660919D5628F), ((U64)0x8FED64F87184A600), ((U64)0xCE5E65EF2C903633), ((U64)0xDE5CFACED553EC66), 
        ((U64)0xF95D9FE80D5BC080), ((U64)0x7908FEABE06265AC), ((U64)0x6CF91F416252CA84), ((U64)0x451DAD986DAD9729), 
        ((U64)0xDC1012D68A6048DE), ((U64)0x71B06AB808192E48), ((U64)0x16C0749FD34773E2), ((U64)0x09C6B32587F0A5B4), 
        ((U64)0xA1AC588E5B7E3E88), ((U64)0x2EDA6C79D74EF1EB), ((U64)0x8E80BEE8BD05F8AE), ((U64)0x990D328A3508301B), 
        ((U64)0x143A6325E0951282), ((U64)0x10632F758962AA84), ((U64)0x3DAE259FBF8F3202), ((U64)0xE2C65E2E7C7B47B2), 
        ((U64)0xE2201035AF56E8F2), ((U64)0xBF3B9F35E3DAB640), ((U64)0xE041885B19ACA8C8), ((U64)0x819A655873686D15), 
        ((U64)0x31B077CC8BFB634C), ((U64)0xA54018BF0D6CF82B), ((U64)0xD61CE48092726A0C), ((U64)0xE29F45C67E1E146A), 
        ((U64)0x9B850C35EC1463CB), ((U64)0x3536468E88A76117), ((U64)0xDE77B45151E1E694), ((U64)0xA75A76555656FBE6), 
        ((U64)0x941E6F8CD57BBE21), ((U64)0x7174482C7C3CC4BB), ((U64)0xE9D31448CAABF1AE), ((U64)0xB4ABF3BC5010D88F), 
        ((U64)0xB54BF4238B690970), ((U64)0x57AEB64B92EE1F1D), ((U64)0x06F70BC87711B349), ((U64)0xC9208853F7081D41), 
        ((U64)0xDFDD4CB65BA18779), ((U64)0x206F647D1D132E32), ((U64)0xB776A6144AE8A149), ((U64)0x5D2CD7EFBED2DFF5), 
        ((U64)0x8619E1713DC9D513), ((U64)0xB8B3D16E3DC503C4), ((U64)0x303C98A21CBAD415), ((U64)0x07CEC8C7DF98A13E), 
        ((U64)0xF7826EC516D9D7E0), ((U64)0x943386BACDA9F395), ((U64)0xC29F23B3E8094A73), ((U64)0xFA193271196EFA16), 
        ((U64)0x9E58630D52AC1D3D), ((U64)0x6ECEF94F7D5A81C3), ((U64)0x927D6A462AAE7096), ((U64)0xBC258BE6785073D8)},
       {((U64)0x176FA00325B31E78), ((U64)0xFBA54B582173B56C), ((U64)0xA5E3CE4CFF5EFE76), ((U64)0xEDEEE1A1D2B90E8E), 
        ((U64)0xB4C5D503E8C81E46), ((U64)0xA853C0C2B2387393), ((U64)0x72B78E40774D8160), ((U64)0x5693ECC59CE0396E), 
        ((U64)0x93639726211F1375), ((U64)0x92DB874FE8DFC644), ((U64)0x86EC90FA14ECA4CF), ((U64)0x0481F454CA90C1A0), 
        ((U64)0xE504AC1DE657D4DF), ((U64)0xF8B0A333447F33F4), ((U64)0x7FC11CE1E9CE8E7B), ((U64)0xC907317C99A3FB43), 
        ((U64)0x3608ECF1F8B0FA9F), ((U64)0x2D70214660948B2C), ((U64)0x7C82276B39A961B0), ((U64)0x21CD3FED7F1CA8B0), 
        ((U64)0x802C1580F957A889), ((U64)0x2FBEBFC6A72DC666), ((U64)0x6158D9E0E4773DE2), ((U64)0x1ABB734350E063FE), 
        ((U64)0xC28705D696DCB5D4), ((U64)0x8ACF0EA8C8B56C38), ((U64)0x069D988479BB4C7F), ((U64)0x9AC1BA80260F8EC7), 
        ((U64)0x0F57AA505FC4E61A), ((U64)0x1B10D879C35A0FB1), ((U64)0x6935E8F8B6DFB205), ((U64)0x860AEA92C8048C2A), 
        ((U64)0x8811EF920D3AA784), ((U64)0xD486D4CE241CD501), ((U64)0xE878450012BC7654), ((U64)0xA81758F26DE6C912), 
        ((U64)0x3837B74BF7E00A3F), ((U64)0x314535440B759E5D), ((U64)0xC618768958333847), ((U64)0xC03EDF451CEAD6B6), 
        ((U64)0xD779F2CE48C36533), ((U64)0x76986E14DFA14523), ((U64)0x149C2A0C71F8407F), ((U64)0x231C311AE7279B62), 
        ((U64)0x23A0B870586BDBF5), ((U64)0xE753EB35368A033A), ((U64)0x38D85437E96E4780), ((U64)0xAB5E9CB523155D76), 
        ((U64)0x6ABBF8C2CE1139FB), ((U64)0x01C7B305A15270BD), ((U64)0xDAF417ED7AAC0300), ((U64)0xFC84FFE0D5A2ACAD), 
        ((U64)0x261BC897B0EB570F), ((U64)0xEFDFE795637D39DA), ((U64)0x7B76698EBF9ECE7C), ((U64)0x11FFE9DF28F26DA1), 
        ((U64)0x1E9144D47DA27907), ((U64)0x67EA8771BFB9F0F5), ((U64)0x88DABC9B5448830D), ((U64)0x5D3CD35D69B20B8C), 
        ((U64)0xBA76C518F1E4E6B3), ((U64)0x54867F07244D2112), ((U64)0xBA2C389CF625D27B), ((U64)0x8D17857FE5181451)},
       {((U64)0x1E000233E0152018), ((U64)0xC2398B93611B8472), ((U64)0x0B2B826400AE3990), ((U64)0xA13598F9A17AC2BB), 
        ((U64)0xAE53A567BD206FDD), ((U64)0x592F80A4F153037C), ((U64)0x4E7B169648F65DAF), ((U64)0x83C846358B893B06), 
        ((U64)0xCFEA657FFA6B4A04), ((U64)0x719FF12D82B5DFE0), ((U64)0x3252E28A7A70E9A6), ((U64)0xAC376F901229FD9D), 
        ((U64)0xF0B906B55DE82BDB), ((U64)0x895D2D2284822FF8), ((U64)0xBC3DB874B6D3BDC1), ((U64)0xE533BE9F0AF05423), 
        ((U64)0xE69F6263EA47F132), ((U64)0x290B14AD27FF8E6F), ((U64)0x485D0BE59B160721), ((U64)0x38B11D8C5938BCB5), 
        ((U64)0xF2A22B8F4948D2CF), ((U64)0x9F7C91EC9CA6A226), ((U64)0xF0B67395AB95924D), ((U64)0xAC49857CF1E2976F), 
        ((U64)0x416A75380A2E821F), ((U64)0xB1BB3A4731EB6254), ((U64)0xD9073D828955ED06), ((U64)0xA0878B0AF5A99A2E), 
        ((U64)0x398EAF80E64F1630), ((U64)0x8634C84968A7BAEE), ((U64)0x13A0F25CB2642B61), ((U64)0x3D9861CF7C1FCE95), 
        ((U64)0x202320A25DC7BDDD), ((U64)0x4992AF199E24F547), ((U64)0x7BCE9542EF596410), ((U64)0x5FE6DFF949481E54), 
        ((U64)0x74128EB19E4CEB49), ((U64)0xA3B7B8771AC588F8), ((U64)0x6A40BCD1AFFA3801), ((U64)0x1F1D3AF8C7D0B1A5), 
        ((U64)0xF8BE3F34861C6C8F), ((U64)0x3B66CE4C2E513903), ((U64)0x4001927D78FBF92C), ((U64)0xF210C63641EB2418), 
        ((U64)0xB066A186B51225B8), ((U64)0x7F11A0CDE3DBA134), ((U64)0x9C721541E4E3C4A6), ((U64)0x1A136CDCB2C95391), 
        ((U64)0x3EDC690E7DD75FEE), ((U64)0x214F2A2EF75117C9), ((U64)0x6ACE4C9D9A0B23FB), ((U64)0x782E6FB16AB34D90), 
        ((U64)0x64F80C41E93461F0), ((U64)0xAF79A0DE569E8754), ((U64)0x6BB9C8DFB7BF89BB), ((U64)0x46C51FFE5FC61EB1), 
        ((U64)0x0D5B2D7C5D8545C6), ((U64)0xF0F5B95B187DA4DD), ((U64)0x57543DC41C86BD53), ((U64)0x1A1EC08AE54A0874), 
        ((U64)0xEAF842A21C493FB7), ((U64)0x45A0A89272DD264D), ((U64)0x0C555461C77E8A1E), ((U64)0x025A65A363AEE13F)},
       {((U64)0x61E4409767D5CA7A), ((U64)0xD1E707D31AEB5D08), ((U64)0xC8B26166B6E0C5BD), ((U64)0x3147DD340B2422A3), 
        ((U64)0x2AEDBF834328ECA9), ((U64)0x9F02EB4C98C058D9), ((U64)0xB04A3CA4C5A301A5), ((U64)0xEEAA97F15AD4E9DC), 
        ((U64)0xCA7E3CE65DD98B7C), ((U64)0x2DE24C2238A7F714), ((U64)0xDE1926EFEA3C7BF8), ((U64)0xAD655C9036C06E9C), 
        ((U64)0x0B42B07E9E2D7EB4), ((U64)0x13367709240A81F8), ((U64)0x3476BB499881A397), ((U64)0xAC0B1E0FA633B409), 
        ((U64)0xE51BD8FC9B4459D6), ((U64)0x7B29007C8BFA4453), ((U64)0x98D8F85F68AEC375), ((U64)0x335A5E1234E5F805), 
        ((U64)0xF0D6958979721E9A), ((U64)0x9B3C2F7C6F59356A), ((U64)0x4FA1BF568581292F), ((U64)0x7D1F944610AFA4AF), 
        ((U64)0xA12C911ABAAACCA4), ((U64)0xB0CF5FDFA6A52119), ((U64)0x8472B4E9C37FDADA), ((U64)0x25FFC3DEDDE7C827), 
        ((U64)0x718CD49735160272), ((U64)0x02CF4D347F627037), ((U64)0xF38A41D6A359B01C), ((U64)0x84AAB81DDC59D697), 
        ((U64)0x232C44CD41C32397), ((U64)0xF50BC7319124753D), ((U64)0x70A7FF992169627F), ((U64)0xE8F590EB96E23A70), 
        ((U64)0x38DDC13755793827), ((U64)0xA3B5E0B796376127), ((U64)0xCFF88E7A1455E903), ((U64)0x8D5D7880F7A9F6F2), 
        ((U64)0xDA33488F95A7F973), ((U64)0xB5877A61F1ECC49C), ((U64)0x5D8AC1EBBCD632F4), ((U64)0x2D71EB1F3AFBE0F0), 
        ((U64)0x6E65F836DB7CBFF8), ((U64)0x0B1039A66E82C14A), ((U64)0x27CC6036089215FB), ((U64)0x2BA749DA1AC3B1D3), 
        ((U64)0x6786AB68B7134692), ((U64)0x89ADCD885CAF4F95), ((U64)0x698DA2752A248378), ((U64)0xD9116170ECA478DD), 
        ((U64)0x3E768F4024C5F6F6), ((U64)0xE8A911D8DEC9BC72), ((U64)0x080ED1E4883DD910), ((U64)0xA9861E35CCB4AEB0), 
        ((U64)0xC827B08CC6A2335F), ((U64)0x5EFD1206C995438E), ((U64)0x0193AF7E25E46083), ((U64)0x46A756090ED6EF0F), 
        ((U64)0x34A5387953FA5189), ((U64)0x3845BC8124AAE9B4), ((U64)0x810102E505D8D2C1), ((U64)0x2C562160D0B39CE4)},
       {((U64)0x00643CFDD1143ADC), ((U64)0x3F55C7A77482FB6E), ((U64)0x03005DA46B16723E), ((U64)0xB10D4C61E656F484), 
        ((U64)0x385BFA27010165EB), ((U64)0x54F5F94A181ED3EB), ((U64)0xE12CAFBB78759083), ((U64)0x64A2D9097B635030), 
        ((U64)0xA966B929E38A1D1D), ((U64)0x814AF1BD24555021), ((U64)0x6FC77A7A916E1306), ((U64)0x07F39B6562F2A2DD), 
        ((U64)0x3B699A49B145C6AA), ((U64)0xB6642B7746B89234), ((U64)0xE2745EB0FDF94B3C), ((U64)0x17F548DE700D6D36), 
        ((U64)0x40C5E68C67C7A1CB), ((U64)0xF27250449A247917), ((U64)0x447DD328B391B5ED), ((U64)0x0EB0E38F10C330DF), 
        ((U64)0x9A913E3F57F3AD2B), ((U64)0x18255505B6E57073), ((U64)0x39226073C559F5C8), ((U64)0x54A57AAF85E7A5FC), 
        ((U64)0xDA15694D8870AAA1), ((U64)0x6BB3DD02E882FCC5), ((U64)0x40684F0A9D589D38), ((U64)0xF512690BF16AB6F3), 
        ((U64)0xC01A5E631E38F422), ((U64)0x7B0895CAD32AA7CC), ((U64)0x14FA44B700E01B77), ((U64)0x7FA9EA8E5552066F), 
        ((U64)0x727505E31D4C95F2), ((U64)0xFF9A0CA632BB3123), ((U64)0xFF8C7E52820C60E1), ((U64)0x5A2BD1D8FD5503A7), 
        ((U64)0x98614DACB385E21B), ((U64)0x2067CE95FD6AA72B), ((U64)0xC447C2D2E0668E8C), ((U64)0x1C67B6ECED1550DD), 
        ((U64)0x962132AF5F85F121), ((U64)0x02A213E614144C2C), ((U64)0x66C03CA73AA84517), ((U64)0xB92767E4CCF8802A), 
        ((U64)0x18669550E5CBC3F5), ((U64)0x9F77684E4A1FEBBD), ((U64)0xE8EF5664939A66C0), ((U64)0xEE81F4BDEFA4EA7A), 
        ((U64)0xF802BDA1A5E57B28), ((U64)0x3D8B90A2AF0D0462), ((U64)0xD1BA27C3CC19E0B9), ((U64)0x2015DF2F6A1624D4), 
        ((U64)0x965F4461C1BF5761), ((U64)0xA4961F14E39EE974), ((U64)0x5F7D4FEE14394FBD), ((U64)0x15AAE795585DD7DD), 
        ((U64)0x5B3EE5D6A919F712), ((U64)0x69A8970564A0C147), ((U64)0xB3214A19758093DF), ((U64)0xC0BE3FE8C8F7FD9C), 
        ((U64)0x9445536E7B168567), ((U64)0x3A9D316395560387), ((U64)0x38375976B853A7A4), ((U64)0xF372FDC8A8C7C980)}
        },{
       {((U64)0xFEC7E9370FF14E80), ((U64)0xC72D82A03381DBE4), ((U64)0xB69D396D866F4E52), ((U64)0x1B6E5492A9B1BEA0), 
        ((U64)0xDC669C225CC9ECE1), ((U64)0x9E30B32D3F0F14F0), ((U64)0xD22ACF2A4C8D6D87), ((U64)0x0B18F08D7DD3B842), 
        ((U64)0x4AEBE61A039D0428), ((U64)0xBD81AB8EBF5E6F46), ((U64)0xE4E5C97AFD27A60E), ((U64)0xC3CA5C1FA16268A0), 
        ((U64)0x7FF5C4E68152BCFE), ((U64)0x4B0EA4FD302C08ED), ((U64)0xC83E6BFAB659FFF0), ((U64)0x2B5A681ACD1D91E8), 
        ((U64)0xF0E5F0E2CBF0F651), ((U64)0xC58E9F95001E38FC), ((U64)0x79D3B2912CE0BDC7), ((U64)0xCF9CE0134B717D83), 
        ((U64)0xB79A008152ED5FC1), ((U64)0x13602F18AAEA837F), ((U64)0xE040AA3D5E3FAB58), ((U64)0x624343C90A2A7598), 
        ((U64)0xDC6D3DA1B3A0F158), ((U64)0xEE105F405923899A), ((U64)0xEC6FEC34AC00FB61), ((U64)0x3FA76EA1E2D244D1), 
        ((U64)0x25FF01B513D7F47F), ((U64)0xF108609D0FA099EE), ((U64)0x6BF8D84DE21788B1), ((U64)0x1AFE063133A9005D), 
        ((U64)0x1745BDB3F484922F), ((U64)0x39E57F075889C53A), ((U64)0xE903DBBF4A628E77), ((U64)0xA27198D103402037), 
        ((U64)0x8C6502E1EE921A64), ((U64)0x20F552A1AFFF9B42), ((U64)0x8C36A12C0F4CABDC), ((U64)0xC5A3A54CC8B329A7), 
        ((U64)0x3ECFD1642BD578D8), ((U64)0x185EEC68DE6773F5), ((U64)0x6D2996FFCF9146D5), ((U64)0xB119549792827007), 
        ((U64)0xE13061A4CE1E8AEF), ((U64)0x386F2F55CA5268CC), ((U64)0xE5E2A91D651B2233), ((U64)0x490B9E97660C2FC8), 
        ((U64)0xCB988D89966DCAEE), ((U64)0x2790770D6C0B626E), ((U64)0xB5DB9AD9C109BAFE), ((U64)0x562382FCD1A887B5), 
        ((U64)0x887A6E77BE410472), ((U64)0xE468DD22ACBD5E9B), ((U64)0x690D5E4BDED14101), ((U64)0xBE9BAF2CCB619478), 
        ((U64)0xCAE91528D50A861D), ((U64)0x40A03DE65B3F5248), ((U64)0x5F84F5E6307CBEA6), ((U64)0xCE4B7A39564DB25B), 
        ((U64)0x0EA0B05113BF8493), ((U64)0x32CF6DC9807F4C07), ((U64)0x2A001D6686104405), ((U64)0x58188FEA088A2951)},
       {((U64)0x4A576713788BA2A5), ((U64)0xAE16804DBD883AAB), ((U64)0xE8112712120AA939), ((U64)0x635293D6ABD54736), 
        ((U64)0x14D57C459CA2D2CD), ((U64)0x55DB1185BD30FC2A), ((U64)0x6C4C8A41CD09BBF3), ((U64)0xCF74F58D52C72C53), 
        ((U64)0xC555FF87163185DB), ((U64)0xAC2EB326E36318C3), ((U64)0x62FC30405A886C52), ((U64)0xF0D17ECF1CADCE26), 
        ((U64)0xDFAF41255873DAEF), ((U64)0xE15DCE2A4405CE61), ((U64)0xDFDD1C76B0C34CF3), ((U64)0xD0A294D58204F461), 
        ((U64)0xF4C38DD023E044A8), ((U64)0xD32619FE0B87D041), ((U64)0x1F62BCE8E5BA7A45), ((U64)0x630675AE63903432), 
        ((U64)0x87B9471EF87F579C), ((U64)0x9214BA44E309DED0), ((U64)0x5004600363523D20), ((U64)0x9D610AA2B6172DC3), 
        ((U64)0xA07BBDE65C5B3608), ((U64)0x2B8D0428FA281BD8), ((U64)0x70119CB7E4987C96), ((U64)0xDFA6F8B104BE1001), 
        ((U64)0xAC03235CE812CCCA), ((U64)0x7EF71C3AC064BEDC), ((U64)0xE48DC9EAFE20D30A), ((U64)0x5B0F2815E3FEA6A2), 
        ((U64)0x12E6160F6B8AD58C), ((U64)0xBC95EDE538300DC0), ((U64)0x4596522F938C5A80), ((U64)0xD8AE8BE48F447662), 
        ((U64)0x16B11FA71CBF5243), ((U64)0xB4868D6AED963DAE), ((U64)0xF4CD20D5BC280434), ((U64)0x9A79A2B0CB242B8F), 
        ((U64)0x9E87487DA2B775D9), ((U64)0xE465E57A7A85A037), ((U64)0x6A4EF54638B10F6F), ((U64)0x092F99478638DEC6), 
        ((U64)0xC38B96026E95AE27), ((U64)0xDA1FA14CE2BA40B6), ((U64)0x1CAE99B0BC357396), ((U64)0x59AC2877129AF3FC), 
        ((U64)0xF59018F074CBC326), ((U64)0x5A649458F14855FB), ((U64)0x107A0A076A155185), ((U64)0x6C22B6E9B1FB97C1), 
        ((U64)0x188FC051386ABF67), ((U64)0xB1491091A1C52C26), ((U64)0x23C6C84DCB26C01D), ((U64)0x7FC0780C8E5F9EC1), 
        ((U64)0x036DF6543A9615C2), ((U64)0xFB8BEC39FF11EAD1), ((U64)0xE2468B341BF78819), ((U64)0x1D37110B1977CB8C), 
        ((U64)0x807F7BF1C014B84C), ((U64)0x3F04484301C5DB73), ((U64)0x36634404F62D2326), ((U64)0x62AF1CD5EC9B3E99)},
       {((U64)0xE85AA8623F04948C), ((U64)0xD0B8B83F98361402), ((U64)0x73E428E1F7099233), ((U64)0x83A2583D63611486), 
        ((U64)0xE770A16066AB28EE), ((U64)0xAF1D1CE3A22429D8), ((U64)0xB099A051650BDF07), ((U64)0xB71EEF198ADD76A2), 
        ((U64)0x26ECD1411368A778), ((U64)0x5EF9B2158A0350D8), ((U64)0xD792BB1B36AFDD12), ((U64)0x86F0F3835F76A1AE), 
        ((U64)0x395E0FD620C8D9BD), ((U64)0x8179818F45E48AD3), ((U64)0x2B583974FC55FD86), ((U64)0x3A35781E736226E1), 
        ((U64)0x43A703242BB53A11), ((U64)0x21E0DB0FEA00CB26), ((U64)0x33B2A87FCF3ECAA6), ((U64)0xEDD55670B7BFEB2A), 
        ((U64)0xD2B6CCE876C8F5FC), ((U64)0xA16AE31AD6E2B2A5), ((U64)0x6B75B51587B2DE5F), ((U64)0xE566BA4C424F28BB), 
        ((U64)0x4688E9EBC2BFCDF2), ((U64)0x2FD1F94BAD30C7BD), ((U64)0x0AD520E49C3EE816), ((U64)0xE6F8DB4909CEF6C4), 
        ((U64)0x32EE982A4D098641), ((U64)0xF6FC27341115CED6), ((U64)0x92C176DE6C1A95C2), ((U64)0x3C453D4CB2F31B7D), 
        ((U64)0x5E9E48C5867EDD4B), ((U64)0x785398CF674E26F7), ((U64)0x15CBCBF2D6A8F43C), ((U64)0xFBCB01232800AC68), 
        ((U64)0x210D52CBF42BBAF7), ((U64)0xB2436F81D5CECEAF), ((U64)0x1313091F62181AD3), ((U64)0x94519E29150740D5), 
        ((U64)0xD78F8BCBCC4B0D62), ((U64)0x7C5F10AA720FF530), ((U64)0x4FB84BC993283624), ((U64)0xDD524E0482BBBAA7), 
        ((U64)0xB23FFB39C15086DC), ((U64)0x70B0C0C3A6F83BBE), ((U64)0x735B196DF8084629), ((U64)0xF6CB836D29EFE956), 
        ((U64)0x71316DA5CD203110), ((U64)0xD0AFCC14FC650B48), ((U64)0xE41D939C085B2390), ((U64)0x5AFB350579AF0B37), 
        ((U64)0x32677CBE6E5C8982), ((U64)0xFC5F0DF24A56A255), ((U64)0x96B1E9441C59204F), ((U64)0x5C81154429F970F9), 
        ((U64)0x1915912829DB9B40), ((U64)0x5A13D78FC1B83F23), ((U64)0x6EEE52535D11D777), ((U64)0xD369006D9516C770), 
        ((U64)0x2EA97320423649D2), ((U64)0x3563C76014C98A0B), ((U64)0x856932A16FCB8046), ((U64)0x139E799BF19ACB97)},
       {((U64)0xE619CEF3F77BC173), ((U64)0x33BBF206292C2429), ((U64)0x8E9E312CFE8C5881), ((U64)0x9F459FD766F66CD0), 
        ((U64)0x4200024341044084), ((U64)0x751EADD75D897E3A), ((U64)0xB81A60A95FB27A01), ((U64)0xCF7EB441D6B6216F), 
        ((U64)0x45F87717D361AE3F), ((U64)0xDF8AE1EACCDF5BC6), ((U64)0x3831065B7EBEAF8C), ((U64)0x7610DA4CD45BF178), 
        ((U64)0xB3CA01C8647232A9), ((U64)0x3B8A09BBD9692680), ((U64)0xA4B7FC4588311CE7), ((U64)0x227B6B0525D6FBA6), 
        ((U64)0xFCD846AF3F9143CB), ((U64)0xC0668E59E929F5EB), ((U64)0xCD4BBBA67A8ECE2B), ((U64)0x4CF18469C69FF8AD), 
        ((U64)0xB85A9CAD9BEADC22), ((U64)0x368AA62A5E156F3E), ((U64)0x3D9C8CC41E7F8255), ((U64)0x51BC4DD6077180C2), 
        ((U64)0xC6DCF18246EE4E54), ((U64)0xFE86FC3933DC618B), ((U64)0x8442E90A88144522), ((U64)0x5F851A7A44A41759), 
        ((U64)0xD38924ED94DD6A26), ((U64)0x73401018CD54C21C), ((U64)0x829B8C77E325AC1A), ((U64)0xB307E2E54D26412E), 
        ((U64)0xFBB65FA6E980E6AC), ((U64)0x85C66F561B83ED1F), ((U64)0x522C4359ACD84AEB), ((U64)0xF2AEFE9CB415A887), 
        ((U64)0xDD41FB208AF8C5C0), ((U64)0x4953F9762848CE83), ((U64)0xF41091595C3DB2F9), ((U64)0xB49376C566FD93B9), 
        ((U64)0xE4309F1ED0B124B5), ((U64)0xDDF24F88EEA5D722), ((U64)0x26EDDEDA5C169234), ((U64)0xF1697ADE82AB31EA), 
        ((U64)0xC8158A1B60702E4E), ((U64)0x204A8049CAAB6221), ((U64)0x17F009A597B4C52A), ((U64)0x4ED1F088C0AB0217), 
        ((U64)0x41C4A97A0B8B21EA), ((U64)0x8D1A31D16B01EE95), ((U64)0x3B4E05E83CFCF05E), ((U64)0x339527603763D857), 
        ((U64)0xE9C9568FBE372403), ((U64)0xCED2D9D4CE125169), ((U64)0xB0D68C7EF58974D9), ((U64)0x604589E3C6CCC55F), 
        ((U64)0xF8281D74D2FB4BD7), ((U64)0x83DFE578B4D1C37D), ((U64)0xE1040393F8EAD3FF), ((U64)0xEEC994716BCAE446), 
        ((U64)0xD5E6A2ACBC432265), ((U64)0x441601B0952B7010), ((U64)0x17199E8C3A0BD6A5), ((U64)0x734ECB4B9428D28B)},
       {((U64)0x28DCAC985610869C), ((U64)0xE3C845317609E760), ((U64)0x04C7224351B10B62), ((U64)0x812418B46D33D655), 
        ((U64)0x4A4BC5BDD1CDAAD0), ((U64)0xCB080CF07F001991), ((U64)0x63D6AA99A81E7023), ((U64)0xFDFC6C1606F1F6FB), 
        ((U64)0x40C0DCDB0E3D1F6E), ((U64)0x0F8A4C36A596BDCC), ((U64)0x925F9E50BFD4DB02), ((U64)0xC619033B45FD8BC5), 
        ((U64)0x5DBB77CC8D8F1EF2), ((U64)0xD7B7213FC23349A9), ((U64)0x5E042E3863767659), ((U64)0xCBDC369A3E0184F2), 
        ((U64)0xF79F7E40DB928F16), ((U64)0xA55F8F6CB6A1DCD0), ((U64)0xBAB5ACAC18C9E412), ((U64)0x954331AA2ED072FB), 
        ((U64)0x306C913E96056B4D), ((U64)0x4E9C3003B04144DC), ((U64)0xB980FA5EDAD9DC43), ((U64)0xF1C9D04FFE1E9017), 
        ((U64)0x11BFD47969068C70), ((U64)0x83541A80EFCBFD81), ((U64)0x0BE2B579FD38DAF8), ((U64)0x2B33AA54E7DE5000), 
        ((U64)0x9E9B1E76F1AC81B8), ((U64)0x05EA957960C150EF), ((U64)0xA8242807FA61B151), ((U64)0xDBBFC5F07F37B9F5), 
        ((U64)0xE375F48298B0EEED), ((U64)0xD5967109AA717C76), ((U64)0x1B3FC2B38F3B0DCD), ((U64)0xDC423A613A239101), 
        ((U64)0x1516C775174623DE), ((U64)0x60E01BD804A47D6C), ((U64)0x8CCD80D3E5B84FE6), ((U64)0xF4A71B95A1A60E7C), 
        ((U64)0xD6B25646F8096112), ((U64)0xFEC7D3A639E76A4C), ((U64)0xF17742C8709C3ADF), ((U64)0x715CF7E5A0A732D0), 
        ((U64)0xE7D48B764613FDBD), ((U64)0xD514E26FA1747C21), ((U64)0xD0759BA7FA5A5BDB), ((U64)0x382720DACB6DF07E), 
        ((U64)0x62919A3D3C2BE2F6), ((U64)0x8A4BA91E7ABDAC23), ((U64)0xE893BF3B8919B72F), ((U64)0xFED88809D9B8B561), 
        ((U64)0x3A7D7094A6191028), ((U64)0x29CC08C8B49709A0), ((U64)0x993CAD4DD9D610FA), ((U64)0x9E75E8FBAD7A9633), 
        ((U64)0xB4ED430A46151CC8), ((U64)0x78982B83C9FF2C1F), ((U64)0x5C0FC745D4A2E4F4), ((U64)0x654069266032A04E), 
        ((U64)0x9AFF2766B05CEB46), ((U64)0x4142DDC4FE8AE5C1), ((U64)0xC37C6D157C0C6184), ((U64)0x6227E6F5B0E595B5)},
       {((U64)0xCDEB431FAEE40146), ((U64)0xD585F951246E99E8), ((U64)0x0AE72E74F999FA16), ((U64)0x6C2600E48CB99754), 
        ((U64)0xDE1BC2A05F26B911), ((U64)0x9C0112BF7628DC1C), ((U64)0xCCD66D72096FE4AC), ((U64)0x40002DA64C2F0184), 
        ((U64)0x1D8DFE5B9C1A4047), ((U64)0x089FCA892DCA3B2A), ((U64)0xEBA61F4B671196B3), ((U64)0x86F1CE5F1EFBFED3), 
        ((U64)0xFDFA02B2A64097D8), ((U64)0x8628F2AB63E35C8F), ((U64)0x3144E89DBD441519), ((U64)0x00BFF3ED00831504), 
        ((U64)0x43443FA95BDA8933), ((U64)0xCF73A9D82009CC16), ((U64)0x3278C1E13B0FAB9D), ((U64)0xC3B240416EF13052), 
        ((U64)0x4AB4F56B733744BD), ((U64)0xDEC77D36250723BE), ((U64)0xEA2AC135CFE15F67), ((U64)0xBCF73CC9BEF670FA), 
        ((U64)0x3F7962A189299D85), ((U64)0xD1E171B3A29F6FDF), ((U64)0x693C768270CCB0DA), ((U64)0x53ECCEE8061CBEF9), 
        ((U64)0x5CEC2995F5981637), ((U64)0x9923C5E556FBF38E), ((U64)0xFF6356DE28EF00A7), ((U64)0xAAD4637D75C7E813), 
        ((U64)0x37259129782F3350), ((U64)0x606BAD7989B5B13E), ((U64)0x498E645116F12C23), ((U64)0xAF6CFA80A0CA4C15), 
        ((U64)0xEA53F6996F334691), ((U64)0xF80FD737AA815BA9), ((U64)0xCA522EDE99A834DB), ((U64)0x65F4ABAA05A15B5D), 
        ((U64)0x895CD513AA73A7B7), ((U64)0xDC877E91BD7412EE), ((U64)0xC8DCDBE3CDD88766), ((U64)0x6114CD29D74FEB98), 
        ((U64)0x1C44D81B4C5B0E6A), ((U64)0x833819C51EF311FD), ((U64)0xDAF390C41F18B57B), ((U64)0xC1335572DED626CB), 
        ((U64)0xE6E05DBF0B228173), ((U64)0xCAEC658BC939B031), ((U64)0x16762DE64DD13744), ((U64)0x9DAD6112EF4E1896), 
        ((U64)0x084BFD9D44238F33), ((U64)0xF6731F5E2585DB3C), ((U64)0x2EEC57012C5F87F2), ((U64)0xE27A559B86A39DB5), 
        ((U64)0x4BAD59B8F348C351), ((U64)0x2FE4AF4192E06D49), ((U64)0xBB9995B9355A3193), ((U64)0x54B5AA9C14EFB9C8), 
        ((U64)0x6ABB0E1E40A20DB4), ((U64)0x6B12522CAC87835E), ((U64)0xBA99D38CFCEE1C22), ((U64)0x089211A984711756)},
       {((U64)0xBA8DA459F6158EB2), ((U64)0x059CA5F579FB3800), ((U64)0x6D865811DF6533DD), ((U64)0x1B336677BC28B60D), 
        ((U64)0xF3383FBA4F307C87), ((U64)0xFB31A7D392A2661B), ((U64)0xE421A8832EC5BADC), ((U64)0xCAF1A002B7100B4C), 
        ((U64)0xBAA7E768B5199609), ((U64)0xDC738671DF195821), ((U64)0x218CB59B8195D9DF), ((U64)0xA082EBC7A9F698E4), 
        ((U64)0xB34DE34A58A6D69B), ((U64)0x3F07588E82180771), ((U64)0x508254C524BBC468), ((U64)0xF38E6C0E11FB3E1C), 
        ((U64)0xE70ED0B8BC885F60), ((U64)0x254AF92BD3014FFC), ((U64)0x131CF1955281040B), ((U64)0xDD26C23FE5A346F4), 
        ((U64)0xFEFB840421A1C9B2), ((U64)0xF4343A5274063C24), ((U64)0xD2A2549970B5BF03), ((U64)0x92AC7E5382987DAC), 
        ((U64)0x3051DBCA6776D6D4), ((U64)0xE5D6EF60ADF5CCE6), ((U64)0xCBD82C7437EF8E07), ((U64)0xEB983C4491FFC285), 
        ((U64)0x3F44BB1A92BFB0E4), ((U64)0x2F139FECDBA36239), ((U64)0x8C61164AC5ED355C), ((U64)0x1CAE089C7D76EDC6), 
        ((U64)0xC00CCF6ACC1BB114), ((U64)0x36EDE4360EF227B6), ((U64)0xEDA01281BD1A552C), ((U64)0x5B16F50B6EA90003), 
        ((U64)0x56C1775D88E0DF1A), ((U64)0x160B5C24F980297A), ((U64)0xB1A622C9B32CE516), ((U64)0xF1E43612738F649C), 
        ((U64)0x1E782F5530101DE6), ((U64)0x7CD921DBC2ECF549), ((U64)0x7EA67E7C90EC0F08), ((U64)0xBC7932BAC1454A82), 
        ((U64)0x582E58DA2D66B994), ((U64)0x36DBC8D9D6C76BF5), ((U64)0x1D723A4AE510BD4A), ((U64)0x005E7F60EF85D73E), 
        ((U64)0xB9F8C1CFC48FCAA2), ((U64)0x59A44AAA1414A6FF), ((U64)0xB77DD0384C446FDC), ((U64)0x18FB8C8AA6C4B835), 
        ((U64)0x7EFCA079D675A263), ((U64)0x55EFB225287D967D), ((U64)0x68ED84E8F0472D02), ((U64)0x5FBA82D39AE75626), 
        ((U64)0xA0B009502AB6B4B4), ((U64)0x996D26420114BB3C), ((U64)0x1329573D8030A11E), ((U64)0x931174E30CA12EF5), 
        ((U64)0x59E233A42F3432EF), ((U64)0x77AC6577DAC22127), ((U64)0xD479D742A3D141BF), ((U64)0x46F52077AB6B19AD)}
}};
        
static const U64        en_passant_keys[64] = 
{
        ((U64)0xB366D1A55AC34195), ((U64)0x60D3FCFBCF572684), ((U64)0x672F9B58D7DFE3F8), ((U64)0xE09ACCE13480CBCE), 
        ((U64)0xFEA61BE2004B3621), ((U64)0xD169BC626DC8EEFF), ((U64)0xFF7171B1307B257B), ((U64)0x637CD3DB2060DBAD), 
        ((U64)0xE66D5CBF3C16EA7E), ((U64)0x2827BBFEDEC37D56), ((U64)0xC5981B79FA1AB2C5), ((U64)0x5673E0CE3F240744), 
        ((U64)0x8E4027DB198906C4), ((U64)0x9AE81971F49F1693), ((U64)0xE69D57E2972CBABF), ((U64)0x628C4CEE35D5D1FA), 
        ((U64)0xAAE26EBFBB93B102), ((U64)0xB5087E6DD9D2CC02), ((U64)0xD3045080B005435F), ((U64)0xB0C13739F723FFCD), 
        ((U64)0xD1D3ED38A1D1E480), ((U64)0x88229C3D8143F5A4), ((U64)0x69B7BE0DBD0B7D91), ((U64)0x1AC995496580C3DF), 
        ((U64)0xF131FABEAA3FCB47), ((U64)0x020D7918CABA89E4), ((U64)0x6F9044BA9680955A), ((U64)0x686BC6695E677E50), 
        ((U64)0x228269EF09979DE0), ((U64)0x28A4C4488D74068A), ((U64)0x8A03D90F93EDA238), ((U64)0xADDBA608B0B9DD4D), 
        ((U64)0x42E64F15944A4D5A), ((U64)0x33DAB61D5AD25EED), ((U64)0xBB7AAE5DE5299BCC), ((U64)0x379D4A75E047F566), 
        ((U64)0xF333B6C452177B90), ((U64)0x268EF0B2AB30236E), ((U64)0x77CF7FBFAF0576BC), ((U64)0x48728CEBB86BA525), 
        ((U64)0x1A78857E764B85A9), ((U64)0xBEB0868586D2D622), ((U64)0x1F7494A9D5954DD4), ((U64)0x05CF67EE0FD157DD), 
        ((U64)0xDD65896EF696A4E1), ((U64)0xBD259BD89CFAA0CF), ((U64)0xC7C3320D3E1C3B6D), ((U64)0xB75668F7BF537BC1), 
        ((U64)0x35201733DA886988), ((U64)0x3DFBE7E95B17601B), ((U64)0x2EF17906F293C711), ((U64)0x25DCE275AE00BF36), 
        ((U64)0xD7FCDAB63DA69449), ((U64)0x0161CAF4B6173800), ((U64)0x3231842170D70B5C), ((U64)0xCE781B16B43E696B), 
        ((U64)0xBEA2B5125E2C91AE), ((U64)0xADE63E0CF7DC2584), ((U64)0xC47784260F6E7826), ((U64)0x0610C765B8066228), 
        ((U64)0x2814D09272609BE1), ((U64)0xAC8151BD42CBC1A8), ((U64)0xBC680D7DC1F5D4E0), ((U64)0x8200AAB8044DBCE4)
};

static const U64        king_side_castle_keys[2][2] = 
{
        {((U64)0x4CB1297B347D9184), ((U64)0xDAF24440D43B9E43)}, {((U64)0x0981309987EC4A67), ((U64)0x0D7D7C634883A7BB)}
};

static const U64        queen_side_castle_keys[2][2] = 
{
        {((U64)0x50DAC80A753049B4), ((U64)0xD2203D893B0399E6)}, {((U64)0xD6AB15746539DAC2), ((U64)0x43EC3CFA891AE17D)}
};

//-------------------------------------------------------------------------------------------------
//    Calculate current position key.
//-------------------------------------------------------------------------------------------------
U64 zk_board_key(BOARD *board)
{
    U64 key = 0;

    for (int i = 0; i < 64; i++) {
        if (piece_on_square(board, BLACK, i) != NO_PIECE) {
            key ^= square_keys[BLACK][piece_on_square(board, BLACK, i)][i];
        }
        if (piece_on_square(board, WHITE, i) != NO_PIECE) {
            key ^= square_keys[WHITE][piece_on_square(board, WHITE, i)][i];
        }
    }

    if (side_on_move(board) == BLACK) key ^= color_key;

    key ^= king_side_castle_keys[WHITE][can_castle_ks_flag(board, WHITE)];
    key ^= queen_side_castle_keys[WHITE][can_castle_qs_flag(board, WHITE)];
    key ^= king_side_castle_keys[BLACK][can_castle_ks_flag(board, BLACK)];
    key ^= queen_side_castle_keys[BLACK][can_castle_qs_flag(board, BLACK)];

    if (ep_square_bb(board)) key ^= en_passant_keys[ep_square(board)];

    return key;
}

//-------------------------------------------------------------------------------------------------
//    Calculate current position pawn key.
//-------------------------------------------------------------------------------------------------
U64 zk_pawn_key(BOARD *board)
{
    U64     pkey = 0;
    U64     piece;
    int     pcsq;

    piece = pawn_bb(board, WHITE);
    while (piece) {
        pcsq = bb_first_index(piece);
        pkey ^= square_keys[WHITE][PAWN][pcsq];
        bb_clear_bit(&piece, pcsq);
    }

    piece = pawn_bb(board, BLACK);
    while (piece) {
        pcsq = bb_first_index(piece);
        pkey ^= square_keys[BLACK][PAWN][pcsq];
        bb_clear_bit(&piece, pcsq);
    }

    if (side_on_move(board) == BLACK) pkey ^= color_key;

    return pkey;
}


//-------------------------------------------------------------------------------------------------
//    Color key
//-------------------------------------------------------------------------------------------------
U64 zk_color(void)
{
    return color_key;
}

//-------------------------------------------------------------------------------------------------
//    Ep Key
//-------------------------------------------------------------------------------------------------
U64 zk_ep(int square)
{
    assert(square >= 0 && square < 64);

    return en_passant_keys[square];
}

//-------------------------------------------------------------------------------------------------
//    King side castle keys
//-------------------------------------------------------------------------------------------------
U64 zk_ks(int color, int flag)
{
    assert(color == WHITE || color == BLACK);
    assert(flag == 0 || flag == 1);

    return king_side_castle_keys[color][flag];
}

//-------------------------------------------------------------------------------------------------
//    Queen side castle keys
//-------------------------------------------------------------------------------------------------
U64 zk_qs(int color, int flag)
{
    assert(color == WHITE || color == BLACK);
    assert(flag == 0 || flag == 1);

    return queen_side_castle_keys[color][flag];
}

//-------------------------------------------------------------------------------------------------
//    Square key
//-------------------------------------------------------------------------------------------------
U64 zk_square(int color, int piece, int square)
{
    assert(color == WHITE || color == BLACK);
    assert(piece >= PAWN && piece <= KING);
    assert(square >= 0 && square < 64);

    return square_keys[color][piece][square];
}

//END
